"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@tiptap/core"),t=require("@tiptap/pm/state"),i=require("@tiptap/pm/view");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=o(require("katex"));const r=e=>{const{regex:o,katexOptions:r={},editor:s,shouldRender:n}=e;return new t.Plugin({key:new t.PluginKey("mathematics"),state:{init:()=>i.DecorationSet.empty,apply(e,t,d,p){const{selection:c}=p,l=[];return p.doc.descendants(((e,t)=>{const d=n(p,t,e);if(e.isText&&e.text&&d){let n;for(;n=o.exec(e.text);){const e=t+n.index,o=e+n[0].length,d=n[1];if(d){const t=c.$from.pos-c.$to.pos,n=c.$anchor.pos>=e&&c.$anchor.pos<=o,p=c.$from.pos>=e&&c.$to.pos<=o,u=0===t&&n||p;u&&s.isEditable||l.push(i.Decoration.widget(e,(()=>{const e=document.createElement("span");e.classList.add("Tiptap-mathematics-render"),s.isEditable&&e.classList.add("Tiptap-mathematics-render--editable");try{a.default.render(d,e,r)}catch(t){e.innerHTML=d}return e}))),l.push(i.Decoration.inline(e,o,{class:u&&s.isEditable?"Tiptap-mathematics-editor":"Tiptap-mathematics-editor Tiptap-mathematics-editor--hidden",style:u&&s.isEditable?void 0:"display: inline-block; height: 0; opacity: 0; overflow: hidden; position: absolute; width: 0;"}))}}}})),l.length>0?i.DecorationSet.create(p.doc,l):i.DecorationSet.empty}},props:{decorations(e){return this.getState(e)}}})},s=(e,t)=>!("codeBlock"===e.doc.resolve(t).parent.type.name),n=e.Extension.create({name:"Mathematics",addOptions:()=>({regex:/\$([^\$]*)\$/gi,katexOptions:void 0,shouldRender:s}),addProseMirrorPlugins(){return[r({...this.options,editor:this.editor})]}});exports.Mathematics=n,exports.MathematicsPlugin=r,exports.default=n,exports.defaultShouldRender=s;
