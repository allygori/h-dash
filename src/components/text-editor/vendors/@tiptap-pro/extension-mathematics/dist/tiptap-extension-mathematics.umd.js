!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@tiptap/core"),require("@tiptap/pm/state"),require("@tiptap/pm/view"),require("katex")):"function"==typeof define&&define.amd?define(["exports","@tiptap/core","@tiptap/pm/state","@tiptap/pm/view","katex"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["@tiptap-pro/extension-mathematics"]={},e.core,e.state,e.view,e.katex)}(this,(function(e,t,i,o,a){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=n(a);const r=e=>{const{regex:t,katexOptions:a={},editor:n,shouldRender:r}=e;return new i.Plugin({key:new i.PluginKey("mathematics"),state:{init:()=>o.DecorationSet.empty,apply(e,i,d,p){const{selection:c}=p,l=[];return p.doc.descendants(((e,i)=>{const d=r(p,i,e);if(e.isText&&e.text&&d){let r;for(;r=t.exec(e.text);){const e=i+r.index,t=e+r[0].length,d=r[1];if(d){const i=c.$from.pos-c.$to.pos,r=c.$anchor.pos>=e&&c.$anchor.pos<=t,p=c.$from.pos>=e&&c.$to.pos<=t,u=0===i&&r||p;u&&n.isEditable||l.push(o.Decoration.widget(e,(()=>{const e=document.createElement("span");e.classList.add("Tiptap-mathematics-render"),n.isEditable&&e.classList.add("Tiptap-mathematics-render--editable");try{s.default.render(d,e,a)}catch(t){e.innerHTML=d}return e}))),l.push(o.Decoration.inline(e,t,{class:u&&n.isEditable?"Tiptap-mathematics-editor":"Tiptap-mathematics-editor Tiptap-mathematics-editor--hidden",style:u&&n.isEditable?void 0:"display: inline-block; height: 0; opacity: 0; overflow: hidden; position: absolute; width: 0;"}))}}}})),l.length>0?o.DecorationSet.create(p.doc,l):o.DecorationSet.empty}},props:{decorations(e){return this.getState(e)}}})},d=(e,t)=>!("codeBlock"===e.doc.resolve(t).parent.type.name),p=t.Extension.create({name:"Mathematics",addOptions:()=>({regex:/\$([^\$]*)\$/gi,katexOptions:void 0,shouldRender:d}),addProseMirrorPlugins(){return[r({...this.options,editor:this.editor})]}});e.Mathematics=p,e.MathematicsPlugin=r,e.default=p,e.defaultShouldRender=d,Object.defineProperty(e,"__esModule",{value:!0})}));
