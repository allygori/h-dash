import{Extension as t}from"@tiptap/core";import{Plugin as e,PluginKey as i}from"@tiptap/pm/state";import{DecorationSet as o,Decoration as s}from"@tiptap/pm/view";import a from"katex";const r=t=>{const{regex:r,katexOptions:n={},editor:p,shouldRender:d}=t;return new e({key:new i("mathematics"),state:{init:()=>o.empty,apply(t,e,i,c){const{selection:m}=c,l=[];return c.doc.descendants(((t,e)=>{const i=d(c,e,t);if(t.isText&&t.text&&i){let i;for(;i=r.exec(t.text);){const t=e+i.index,o=t+i[0].length,r=i[1];if(r){const e=m.$from.pos-m.$to.pos,i=m.$anchor.pos>=t&&m.$anchor.pos<=o,d=m.$from.pos>=t&&m.$to.pos<=o,c=0===e&&i||d;c&&p.isEditable||l.push(s.widget(t,(()=>{const t=document.createElement("span");t.classList.add("Tiptap-mathematics-render"),p.isEditable&&t.classList.add("Tiptap-mathematics-render--editable");try{a.render(r,t,n)}catch(e){t.innerHTML=r}return t}))),l.push(s.inline(t,o,{class:c&&p.isEditable?"Tiptap-mathematics-editor":"Tiptap-mathematics-editor Tiptap-mathematics-editor--hidden",style:c&&p.isEditable?void 0:"display: inline-block; height: 0; opacity: 0; overflow: hidden; position: absolute; width: 0;"}))}}}})),l.length>0?o.create(c.doc,l):o.empty}},props:{decorations(t){return this.getState(t)}}})},n=(t,e)=>!("codeBlock"===t.doc.resolve(e).parent.type.name),p=t.create({name:"Mathematics",addOptions:()=>({regex:/\$([^\$]*)\$/gi,katexOptions:void 0,shouldRender:n}),addProseMirrorPlugins(){return[r({...this.options,editor:this.editor})]}});export{p as Mathematics,r as MathematicsPlugin,p as default,n as defaultShouldRender};
